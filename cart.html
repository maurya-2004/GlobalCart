<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - E-Commerce</title>
    <link rel="icon" href="/logo.ico">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <section id="header">
        <a href="#"><img width="40px" src="img/logo.png" class="logo" alt=""></a>
        <div>
            <ul id="navbar">
                <li><a href="index.html">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li id="userSection" style="display: none;">
                    <span id="userName"></span>
                    <a href="#" id="logoutBtn">Logout</a>
                </li>
                <li id="loginSection" style="display: flex;">
                    <a href="login.html">Login</a>
                    <a href="signup.html">Sign Up</a>
                </li>
                <li><a class="active" href="cart.html"><i class="fas fa-shopping-cart"></i></a></li>
                <a href="#" id="close"><i class="far fa-times"></i></a>
            </ul>
        </div>
        <div id="mobile">
            <a href="cart.html"><i class="fa fa-shopping-bag" aria-hidden="true"></i></a>
            <i id="bar" class="fas fa-outdent"></i>
        </div>
    </section>

    <section id="cart" class="section-p1">
        <div id="cart-loading" style="display:none;text-align:center;padding:40px;">
            <div class="spinner"></div>
        </div>
        <div id="login-required" style="display: none; text-align: center; padding: 50px;">
            <h2>Please Login to View Your Cart</h2>
            <p>You need to be logged in to view and manage your shopping cart.</p>
            <a href="login.html" class="normal">Login Now</a>
        </div>
        <div id="empty-cart" style="display: none; text-align: center; padding: 50px;">
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added anything to your cart yet.</p>
            <a href="shop.html" class="normal">Shop Now</a>
        </div>
        <div id="cart-content" style="display: none;">
        <table width="100%">
            <thead>
                <tr>
                    <td>Remove</td>
                    <td>Image</td>
                        <td>Product</td>
                    <td>Price</td>
                    <td>Quantity</td>
                    <td>Subtotal</td>
                </tr>
            </thead>
                <tbody id="cart-items">
                    
            </tbody>
        </table>
        </div>
        <div id="cart-toast" class="cart-toast" style="display:none;"></div>
    </section>

    <section id="cart-add" class="section-p1">
        <div id="coupon">
            <h3>Apply Coupon</h3>
            <div>
                <input type="text" placeholder="Enter Your Coupon">
                <button class="normal">Apply</button>
            </div>
        </div>

        <div class="cart-total">
            <h3>Cart Total</h3>
            <table>
                <tr>
                    <td>Cart Subtotal</td>
                    <td id="cart-subtotal">₹0.00</td>
                </tr>
                <tr>
                    <td>Shipping</td>
                    <td>Free</td>
                </tr>
                <tr>
                    <td><strong>Total</strong></td>
                    <td id="cart-total"><strong>₹0.00</strong></td>
                </tr>
            </table>
            <button id="checkout-btn" class="normal" onclick="window.location.href='checkout.html'">Proceed to Checkout</button>
        </div>
    </section>

    <section id="newsletter" class="section-p1 section-m1">
        <div class="newstext">
            <h4>Sign Up For Newsletters</h4>
            <p>Get E-mail updates about our latest shop and <span>special offers.</span></p>
        </div>
        <div class="form">
            <input type="text" placeholder="Your email address">
            <button class="normal">Sign Up</button>
        </div>
    </section>

    <footer class="section-p1">
        <div class="col">
            <img width="40px" class="logo" src="img/logo.png" alt="">
            <h4>Contact</h4>
            <p><strong>Address:</strong>A-9, Aghora City Centre, Vadodara</p>
            <p><strong>Phone:</strong>(+91)-9876543210/(+91-9678345612)</p>
            <p><strong>Hours:</strong>10:00 - 20:00, Mon - Sat</p>
            <div class="follow">
                <h4>Follow Us</h4>
                <div class="icon">
                    <i class="fab fa-facebook"></i>
                    <i class="fab fa-twitter"></i>
                    <i class="fab fa-instagram"></i>
                    <i class="fab fa-pinterest"></i>
                    <i class="fab fa-youtube"></i>
                </div>
            </div>
        </div>

        <div class="col">
            <h4>About</h4>
            <a href="#">About Us</a>
            <a href="#">Delivery Information</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms & Conditions</a>
            <a href="#">Contact Us</a>
        </div>

        <div class="col">
            <h4>Account</h4>
            <a href="#">Sign In</a>
            <a href="#">View Cart</a>
            <a href="#">My Wishlist</a>
            <a href="#">Track My Order</a>
            <a href="#">Help </a>
        </div>

        <div class="col install">
            <h4>Install App</h4>
            <p> From App Store or Google Play</p>
            <div class="row">
                <img src="img/pay/app.jpg" alt="">
                <img src="img/pay/play.jpg" alt="">
            </div>
            <p>Secured Payment Gateway</p>
            <img src="img/pay/pay.png" alt="">
        </div>

        <div class="copyright">
            <p>© 2025, Maurya Patel - Global Cart</p>
        </div>
    </footer>

    <script src="auth.js"></script>
    <script src="localCart.js"></script>
    <script>
        // Using showToast from localCart.js now
        // function showToast(message, type = 'success') {
        //     const toast = document.getElementById('cart-toast');
        //     toast.textContent = message;
        //     toast.className = 'cart-toast ' + type;
        //     toast.style.display = 'block';
        //     setTimeout(() => { toast.style.display = 'none'; }, 2000);
        // }

        // The following show/hide loading/login/empty functions are now largely handled by loadCartPage in localCart.js,
        // but kept here for local UI management if needed, or if loadCartPage calls them directly.
        function showLoading() {
            document.getElementById('cart-loading').style.display = 'block';
            document.getElementById('login-required').style.display = 'none';
            document.getElementById('empty-cart').style.display = 'none';
            document.getElementById('cart-content').style.display = 'none';
        }
        function hideLoading() {
            document.getElementById('cart-loading').style.display = 'none';
        }
        function showLoginRequired() {
            document.getElementById('login-required').style.display = 'block';
            document.getElementById('empty-cart').style.display = 'none';
            document.getElementById('cart-content').style.display = 'none';
            console.log('Login required message displayed.');
        }
        function showEmptyCart() {
            document.getElementById('login-required').style.display = 'none';
            document.getElementById('empty-cart').style.display = 'block';
            document.getElementById('cart-content').style.display = 'none';
            document.getElementById('cart-subtotal').textContent = '$0.00';
            document.getElementById('cart-total').textContent = '$0.00';
            console.log('Empty cart message displayed.');
        }
        function showCartContent() {
            document.getElementById('login-required').style.display = 'none';
            document.getElementById('empty-cart').style.display = 'none';
            document.getElementById('cart-content').style.display = 'block';
            console.log('Cart content displayed.');
        }

        // Removed async and fetch calls, now using loadCartPage from localCart.js
        // async function loadCart() {
        //     console.log('loadCart function called');
        //     const token = localStorage.getItem('token');
        //     if (!token) {
        //         showLoginRequired();
        //         console.log('No token found, redirecting to login.');
        //         return;
        //     }
        //     showLoading();
        //     console.log('Fetching cart data...');
        //     try {
        //         const response = await fetch('http://localhost:3000/api/cart', {
        //             headers: {
        //                 'Authorization': `Bearer ${token}`
        //             }
        //         });
        //         const cart = await response.json();
        //         hideLoading();
        //         if (response.ok) {
        //             console.log('Cart data fetched successfully:', cart);
        //             if (!cart.items || cart.items.length === 0) {
        //                 showEmptyCart();
        //                 document.getElementById('checkout-btn').disabled = true;
        //                 console.log('Cart is empty.');
        //                 return;
        //             }
        //             // Render cart items
        //             const cartItems = document.getElementById('cart-items');
        //             cartItems.innerHTML = cart.items.map(item => `
        //                 <tr class="cart-row" tabindex="0">
        //                     <td><a href="#" onclick="removeFromCart('${item.productId}')" aria-label="Remove ${item.name} from cart"><i class="fas fa-times-circle"></i></a></td>
        //                     <td><img src="${item.image}" alt="${item.name}" style="width:60px;height:60px;object-fit:cover;"></td>
        //                     <td>${item.name}</td>
        //                     <td>$${item.price.toFixed(2)}</td>
        //                     <td>
        //                         <button class="qty-btn" aria-label="Decrease quantity" onclick="updateQuantity('${item.productId}', ${item.quantity - 1})" ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
        //                         <input type="number" value="${item.quantity}" min="1" aria-label="Quantity for ${item.name}" onchange="updateQuantity('${item.productId}', this.value)">
        //                         <button class="qty-btn" aria-label="Increase quantity" onclick="updateQuantity('${item.productId}', ${item.quantity + 1})">+</button>
        //                     </td>
        //                     <td>$${(item.price * item.quantity).toFixed(2)}</td>
        //                 </tr>
        //             `).join('');
        //             // Update totals
        //             const subtotal = cart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        //             document.getElementById('cart-subtotal').textContent = `$${subtotal.toFixed(2)}`;
        //             document.getElementById('cart-total').textContent = `$${subtotal.toFixed(2)}`;
        //             showCartContent();
        //             document.getElementById('checkout-btn').disabled = false;
        //             console.log('Cart items rendered and totals updated.');
        //         } else {
        //             showLoginRequired();
        //             console.log('Response not OK, showing login required.', data);
        //         }
        //     } catch (error) {
        //         hideLoading();
        //         showLoginRequired();
        //         console.error('Error loading cart:', error);
        //     }
        // }
        // Removed async and fetch calls, now using updateQuantity from localCart.js
        // async function updateQuantity(productId, quantity) {
        //     console.log('updateQuantity called for productId:', productId, 'quantity:', quantity);
        //     const token = localStorage.getItem('token');
        //     if (!token) {
        //         console.log('No token for updateQuantity, showing login required.');
        //         return showLoginRequired();
        //     }
        //     if (quantity < 1) {
        //         console.log('Quantity less than 1, returning.');
        //         return;
        //     }
        //     try {
        //         const response = await fetch('http://localhost:3000/api/cart/update', {
        //             method: 'PUT',
        //             headers: {
        //                 'Content-Type': 'application/json',
        //                 'Authorization': `Bearer ${token}`
        //             },
        //             body: JSON.stringify({ productId, quantity: parseInt(quantity) })
        //         });
        //         if (response.ok) {
        //             loadCart();
        //             showToast('Quantity updated!');
        //         } else {
        //             const data = await response.json();
        //             showToast(data.error || 'Failed to update quantity', 'error');
        //         }
        //     } catch (error) {
        //         showToast('An error occurred while updating quantity', 'error');
        //     }
        // }
        // Removed async and fetch calls, now using removeFromCart from localCart.js
        // async function removeFromCart(productId) {
        //     const token = localStorage.getItem('token');
        //     if (!token) return showLoginRequired();
        //     if (!confirm('Are you sure you want to remove this item from your cart?')) return;
        //     try {
        //         const response = await fetch(`http://localhost:3000/api/cart/remove/${productId}`, {
        //             method: 'DELETE',
        //             headers: {
        //                 'Authorization': `Bearer ${token}`
        //             }
        //         });
        //         if (response.ok) {
        //             loadCart();
        //             showToast('Item removed from cart!');
        //         } else {
        //             const data = await response.json();
        //             showToast(data.error || 'Failed to remove item', 'error');
        //         }
        //     } catch (error) {
        //         showToast('An error occurred while removing item', 'error');
        //     }
        // }
        function proceedToCheckout() {
            if (document.getElementById('checkout-btn').disabled) return;
            alert('Checkout functionality will be implemented here');
        }
        // Removed specific showLogoutOnlyNavbar as updateNavigation from auth.js handles this now
        // function showLogoutOnlyNavbar() {
        //     document.getElementById('logoutOnlySection').style.display = 'flex';
        //     var userSection = document.getElementById('userSection');
        //     var loginSection = document.getElementById('loginSection');
        //     if (userSection) userSection.style.display = 'none';
        //     if (loginSection) loginSection.style.display = 'none';
        // }
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event fired in cart.html');
            updateNavigation(); // Update navbar on load (from auth.js)
            
            // Add logout functionality to the navbar's logout button (if it exists)
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (confirm('Are you sure you want to logout?')) {
                        handleLogout(); // Assuming handleLogout is in auth.js
                    }
                });
            }
            loadCartPage(); // Call loadCartPage from localCart.js
        });
    </script>
</body>

</html>